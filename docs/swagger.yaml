basePath: /
definitions:
  iface.createOrderRequest:
    properties:
      dropoff_lat:
        type: number
      dropoff_lng:
        type: number
      pickup_lat:
        type: number
      pickup_lng:
        type: number
    required:
    - dropoff_lat
    - dropoff_lng
    - pickup_lat
    - pickup_lng
    type: object
  iface.droneListResponse:
    properties:
      data:
        items:
          $ref: '#/definitions/iface.droneStatusResponse'
        type: array
      meta:
        $ref: '#/definitions/iface.paginationMeta'
    type: object
  iface.droneLocationRequest:
    properties:
      lat:
        type: number
      lng:
        type: number
    type: object
  iface.droneStatusResponse:
    properties:
      assignment_pending:
        type: boolean
      current_order_id:
        type: integer
      drone_id:
        type: integer
      handoff_order_id:
        type: integer
      last_heartbeat:
        type: string
      lat:
        type: number
      lng:
        type: number
      order_status:
        type: string
      status:
        type: string
    type: object
  iface.locationResponse:
    properties:
      lat:
        type: number
      lng:
        type: number
    type: object
  iface.loginRequest:
    properties:
      name:
        type: string
      password:
        type: string
    required:
    - name
    - password
    type: object
  iface.loginResponse:
    properties:
      access_token:
        type: string
      expires_in:
        type: integer
      token_type:
        type: string
      user:
        $ref: '#/definitions/iface.userResponse'
    type: object
  iface.orderListResponse:
    properties:
      data:
        items:
          $ref: '#/definitions/iface.orderResponse'
        type: array
      meta:
        $ref: '#/definitions/iface.paginationMeta'
    type: object
  iface.orderResponse:
    properties:
      assigned_drone_id:
        type: integer
      canceled_at:
        type: string
      created_at:
        type: string
      drone_location:
        $ref: '#/definitions/iface.locationResponse'
      dropoff:
        $ref: '#/definitions/iface.locationResponse'
      eta_minutes:
        type: integer
      handoff_lat:
        type: number
      handoff_lng:
        type: number
      order_id:
        type: integer
      pickup:
        $ref: '#/definitions/iface.locationResponse'
      status:
        type: string
      updated_at:
        type: string
    type: object
  iface.paginationMeta:
    properties:
      has_next:
        type: boolean
      page:
        type: integer
      page_size:
        type: integer
    type: object
  iface.updateRouteRequest:
    properties:
      dropoff_lat:
        type: number
      dropoff_lng:
        type: number
      pickup_lat:
        type: number
      pickup_lng:
        type: number
    type: object
  iface.userResponse:
    properties:
      id:
        type: integer
      name:
        type: string
      type:
        type: string
    type: object
host: localhost:8080
info:
  contact: {}
  description: |-
    REST + WebSocket APIs that power the Drone Delivery Management platform.

    * Authentication: Bearer JWT tokens acquired from `POST /auth/token`.
    * Authorization: Role based (enduser, drone, admin) – documented per route.
  title: Drone Delivery Management API
  version: 1.0.0
paths:
  /admin/drones:
    get:
      consumes:
      - application/json
      description: Get a paginated list of all drones with their status
      parameters:
      - description: 'Page number (default: 1)'
        in: query
        name: page
        type: integer
      - description: 'Page size (default: 10)'
        in: query
        name: page_size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: List of drones
          schema:
            $ref: '#/definitions/iface.droneListResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden - Admin only
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: List all drones (Admin action)
      tags:
      - admin
  /admin/drones/{id}/fixed:
    post:
      consumes:
      - application/json
      description: Admin marks a broken drone as fixed and ready for operation
      parameters:
      - description: Drone ID
        in: path
        name: id
        required: true
        type: integer
      - description: Drone location
        in: body
        name: location
        required: true
        schema:
          $ref: '#/definitions/iface.droneLocationRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Drone marked as fixed
          schema:
            $ref: '#/definitions/iface.droneStatusResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden - Admin only
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Drone not found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Mark drone as fixed (Admin action)
      tags:
      - admin
  /admin/orders:
    get:
      consumes:
      - application/json
      description: Get a paginated list of all orders with optional filters
      parameters:
      - description: 'Page number (default: 1)'
        in: query
        name: page
        type: integer
      - description: 'Page size (default: 10)'
        in: query
        name: page_size
        type: integer
      - description: Filter by order status
        in: query
        name: status
        type: string
      - description: Filter by end user ID
        in: query
        name: enduser_id
        type: integer
      - description: Filter by assigned drone ID
        in: query
        name: assigned_drone_id
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: List of orders
          schema:
            $ref: '#/definitions/iface.orderListResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: List all orders (Admin action)
      tags:
      - admin
  /admin/orders/{id}:
    patch:
      consumes:
      - application/json
      description: Admin updates the pickup or dropoff location of an order
      parameters:
      - description: Order ID
        in: path
        name: id
        required: true
        type: integer
      - description: Route update details
        in: body
        name: route
        required: true
        schema:
          $ref: '#/definitions/iface.updateRouteRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Route updated successfully
          schema:
            $ref: '#/definitions/iface.orderResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Order not found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Update order route (Admin action)
      tags:
      - admin
  /auth/token:
    post:
      consumes:
      - application/json
      description: Authenticate a user and return an access token
      parameters:
      - description: Login credentials
        in: body
        name: credentials
        required: true
        schema:
          $ref: '#/definitions/iface.loginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Login successful
          schema:
            $ref: '#/definitions/iface.loginResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Invalid credentials
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: User login
      tags:
      - auth
  /drones/{id}/broken:
    post:
      consumes:
      - application/json
      description: Report that a drone is broken (can be called by drone or admin)
      parameters:
      - description: Drone ID
        in: path
        name: id
        required: true
        type: integer
      - description: Drone location
        in: body
        name: location
        required: true
        schema:
          $ref: '#/definitions/iface.droneLocationRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Drone marked as broken
          schema:
            $ref: '#/definitions/iface.droneStatusResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Drone not found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Report drone as broken
      tags:
      - drones
  /health:
    get:
      description: Check if the API is running
      produces:
      - text/plain
      responses:
        "200":
          description: OK
          schema:
            type: string
      summary: Health check
      tags:
      - health
  /orders:
    post:
      consumes:
      - application/json
      description: Create a new delivery order with pickup and dropoff locations
      parameters:
      - description: Order details
        in: body
        name: order
        required: true
        schema:
          $ref: '#/definitions/iface.createOrderRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Order created successfully
          schema:
            $ref: '#/definitions/iface.orderResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Create a new delivery order
      tags:
      - orders
  /orders/{id}:
    get:
      consumes:
      - application/json
      description: Get detailed information about a specific order
      parameters:
      - description: Order ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Order details
          schema:
            $ref: '#/definitions/iface.orderResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Order not found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get order details
      tags:
      - orders
  /orders/{id}/cancel:
    post:
      consumes:
      - application/json
      description: Cancel a pending delivery order
      parameters:
      - description: Order ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Order canceled successfully
          schema:
            $ref: '#/definitions/iface.orderResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Order not found
          schema:
            additionalProperties:
              type: string
            type: object
        "409":
          description: Order cannot be canceled
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Cancel an order
      tags:
      - orders
  /orders/{id}/deliver:
    post:
      consumes:
      - application/json
      description: Drone delivers an order to the dropoff location
      parameters:
      - description: Order ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Order delivered successfully
          schema:
            $ref: '#/definitions/iface.orderResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Order not found
          schema:
            additionalProperties:
              type: string
            type: object
        "409":
          description: Order cannot be delivered
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Deliver an order (Drone action)
      tags:
      - drone-actions
  /orders/{id}/fail:
    post:
      consumes:
      - application/json
      description: Drone reports that an order delivery has failed
      parameters:
      - description: Order ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Order marked as failed
          schema:
            $ref: '#/definitions/iface.orderResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Order not found
          schema:
            additionalProperties:
              type: string
            type: object
        "409":
          description: Order cannot be failed
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Fail an order (Drone action)
      tags:
      - drone-actions
  /orders/{id}/pickup:
    post:
      consumes:
      - application/json
      description: Drone picks up an order from the pickup location
      parameters:
      - description: Order ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Order picked up successfully
          schema:
            $ref: '#/definitions/iface.orderResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Order not found
          schema:
            additionalProperties:
              type: string
            type: object
        "409":
          description: Order cannot be picked up
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Pickup an order (Drone action)
      tags:
      - drone-actions
  /orders/{id}/reserve:
    post:
      consumes:
      - application/json
      description: Drone reserves a pending order for delivery
      parameters:
      - description: Order ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Order reserved successfully
          schema:
            $ref: '#/definitions/iface.orderResponse'
        "400":
          description: Invalid request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Order not found
          schema:
            additionalProperties:
              type: string
            type: object
        "409":
          description: Order cannot be reserved
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: Reserve an order (Drone action)
      tags:
      - drone-actions
  /ws/heartbeat:
    get:
      consumes:
      - application/json
      description: |-
        Establishes a WebSocket connection for drones to send heartbeat updates and receive assignments
        The drone must authenticate with a Bearer token in the query parameter or header.

        **Message Types:**

        1. **Heartbeat** (Drone → Server):
        ```json
        {
        "type": "heartbeat",
        "lat": 40.7128,
        "lng": -74.0060
        }
        ```

        2. **Heartbeat Response** (Server → Drone):
        ```json
        {
        "type": "heartbeat",
        "message": "heartbeat received",
        "timestamp": "2025-11-10T12:00:00Z"
        }
        ```

        3. **Assignment** (Server → Drone):
        ```json
        {
        "type": "assignment",
        "drone_id": 1,
        "order_id": 123,
        "pickup_lat": 40.7128,
        "pickup_lng": -74.0060,
        "dropoff_lat": 40.7580,
        "dropoff_lng": -73.9855,
        "enduser_id": 456,
        "order_status": "reserved",
        "created_at": "2025-11-10T12:00:00Z"
        }
        ```

        4. **Assignment Acknowledgment** (Drone → Server):
        ```json
        {
        "type": "assignment_ack",
        "order_id": 123,
        "status": "accepted"
        }
        ```
      parameters:
      - description: Bearer token can also be passed as query parameter
        in: query
        name: Authorization
        type: string
      produces:
      - application/json
      responses:
        "101":
          description: Switching Protocols - WebSocket connection established
          schema:
            type: string
        "400":
          description: Bad request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: WebSocket heartbeat endpoint for drones
      tags:
      - drone-websocket
schemes:
- http
securityDefinitions:
  BearerAuth:
    description: Type "Bearer" followed by a space and JWT token.
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
